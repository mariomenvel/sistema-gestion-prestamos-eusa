<!-- Pr√©stamos Activos PAS -->
<div class="prestamos-activos">

  <!-- Encabezado -->
  <div class="header">
    <h1 class="page-title">Pr√©stamos Activos</h1>
    <p class="page-subtitle">Listado de todos los pr√©stamos activos pendientes de devoluci√≥n</p>
  </div>

  <!-- Tabla de pr√©stamos -->
  <div class="table-container">
    
    <!-- Header de la tabla -->
    <div class="table-header">
      <div class="th th-alumno">Alumno</div>
      <div class="th th-tipo">Tipo</div>
      <div class="th th-material">Material</div>
      <div class="th th-fecha-prestamo">Fecha Pr√©stamo</div>
      <div class="th th-fecha-devolucion">Fecha Devoluci√≥n</div>
      <div class="th th-accion">Acci√≥n</div>
    </div>

    <!-- Body de la tabla -->
    <div class="table-body">
      
      <!-- Loading -->
      <div class="empty-state" *ngIf="isLoading">
        <p>Cargando pr√©stamos...</p>
      </div>

      <!-- Error -->
      <div class="empty-state error" *ngIf="errorMessage">
        <p>{{ errorMessage }}</p>
      </div>

      <!-- Sin pr√©stamos -->
      <div class="empty-state" *ngIf="!isLoading && !errorMessage && prestamos.length === 0">
        <p>No hay pr√©stamos activos</p>
      </div>

      <!-- Filas de pr√©stamos -->
      <div 
        class="table-row" 
        *ngFor="let prestamo of prestamos"
        [class.vencido]="esVencido(prestamo)"
      >
        <!-- Columna: Alumno -->
        <div class="td td-alumno">
          {{ getNombreUsuario(prestamo) }}
        </div>

        <!-- Columna: Tipo -->
        <div class="td td-tipo">
          <span class="badge-tipo">
            {{ getTipoTexto(prestamo.tipo) }}
          </span>
        </div>

        <!-- Columna: Material -->
        <div class="td td-material">
          <!-- Si tiene m√∫ltiples materiales, mostrar como enlace clickeable -->
          <span 
            *ngIf="tieneMultiplesMateriales(prestamo)"
            class="material-link"
            (click)="verDetallesMateriales(prestamo, $event)"
          >
            {{ getNombreMaterial(prestamo) }}
          </span>
          
          <!-- Si tiene un solo material, mostrar texto normal -->
          <span *ngIf="!tieneMultiplesMateriales(prestamo)">
            {{ getNombreMaterial(prestamo) }}
          </span>
        </div>

        <!-- Columna: Fecha Pr√©stamo -->
        <div class="td td-fecha-prestamo">
          {{ formatearFecha(prestamo.fecha_inicio) }}
        </div>

        <!-- Columna: Fecha Devoluci√≥n -->
        <div class="td td-fecha-devolucion">
          <span class="fecha-wrapper">
            <span 
              class="icono-calendario"
              [class.vencido]="esVencido(prestamo)"
            >
              üìÖ
            </span>
            {{ formatearFecha(prestamo.fecha_devolucion_prevista) }}
          </span>
        </div>

        <!-- Columna: Acci√≥n -->
        <div class="td td-accion">
          <button 
            class="btn-devolucion"
            (click)="registrarDevolucion(prestamo)"
          >
            Registrar Devoluci√≥n
          </button>
        </div>

      </div>

    </div>

  </div>

</div>

<!<!-- MODAL: Detalle de Materiales -->
<div class="modal-overlay" *ngIf="mostrarModalMateriales" (click)="cerrarModalMateriales()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    
    <!-- Bot√≥n cerrar -->
    <button class="btn-cerrar" (click)="cerrarModalMateriales()">‚úï</button>

    <!-- Header del modal -->
    <div class="modal-header">
      <h2 class="modal-title">Materiales del Pr√©stamo</h2>
    </div>

    <!-- Info del alumno -->
    <div class="modal-alumno" *ngIf="prestamoSeleccionado">
      <span class="alumno-label">Alumno:</span>
      <span class="alumno-nombre">{{ getNombreUsuario(prestamoSeleccionado) }}</span>
    </div>

    <!-- Lista de materiales -->
    <div class="materiales-lista">
      <div class="material-item" *ngFor="let item of materialesSeleccionados; let i = index">
        <div class="material-numero">{{ i + 1 }}</div>
        <div class="material-info">
          <div class="material-nombre">{{ getNombreItem(item) }}</div>
          <div class="material-detalles">
            <span class="material-tipo">{{ getTipoItem(item) }}</span>
            <span class="material-codigo">C√≥digo: {{ getCodigoItem(item) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn-cerrar-modal" (click)="cerrarModalMateriales()">Cerrar</button>
    </div>

  </div>
</div>