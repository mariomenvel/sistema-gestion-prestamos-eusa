<!-- Mis Préstamos Alumno -->
<div class="mis-prestamos">

  <!-- Título principal -->
  <h1 class="page-title">Mis Préstamos</h1>

  <!-- Barra de búsqueda y filtros -->
  <div class="search-filters-container">

    <!-- Búsqueda por material -->
    <div class="search-box">
      <input type="text" class="search-input" placeholder="Buscar por material..." [(ngModel)]="textoBusqueda"
        (input)="aplicarFiltros()">
    </div>

    <!-- Filtros -->
    <div class="filters-box">

      <!-- Filtro por tipo -->
      <div class="filter-group">
        <label class="filter-label">Tipo:</label>
        <select class="filter-select" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="tipoA">Tipo A</option>
          <option value="tipoB">Tipo B</option>
        </select>
      </div>

      <!-- Filtro por estado -->
      <div class="filter-group">
        <label class="filter-label">Estado:</label>
        <select class="filter-select" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="pendiente">Pendiente</option>
          <option value="activo">Activo</option>
          <option value="vencido">Vencido</option>
          <option value="cerrado">Completado</option>
        </select>
      </div>

      <!-- Filtro desde fecha -->
      <div class="filter-group">
        <label class="filter-label">Desde:</label>
        <input type="date" class="filter-date" [(ngModel)]="filtroFechaDesde" (change)="aplicarFiltros()">
      </div>

      <!-- Filtro hasta fecha -->
      <div class="filter-group">
        <label class="filter-label">Hasta:</label>
        <input type="date" class="filter-date" [(ngModel)]="filtroFechaHasta" (change)="aplicarFiltros()">
      </div>

      <!-- Botón limpiar filtros -->
      <button class="btn-limpiar" (click)="limpiarFiltros()" title="Limpiar todos los filtros">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
          <path d="M3 3v5h5" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Tabla de préstamos -->
  <div class="table-container">

    <!-- Header de la tabla -->
    <div class="table-header">
      <div class="th th-material sortable" (click)="ordenar('material')">
        Material
        <span class="sort-icon" [class.active]="sortColumn === 'material'">
          {{ sortColumn === 'material' ? (sortDirection === 'asc' ? '↑' : '↓') : '↕' }}
        </span>
      </div>
      <div class="th th-tipo">Tipo</div>
      <div class="th th-fecha-prestamo sortable" (click)="ordenar('fecha')">
        Fecha Préstamo
        <span class="sort-icon" [class.active]="sortColumn === 'fecha'">
          {{ sortColumn === 'fecha' ? (sortDirection === 'asc' ? '↑' : '↓') : '↕' }}
        </span>
      </div>
      <div class="th th-fecha-devolucion">Fecha Devolución</div>
      <div class="th th-estado">Estado</div>
    </div>

    <!-- Body de la tabla -->
    <div class="table-body">

      <!-- Loading -->
      <div class="empty-state" *ngIf="isLoading">
        Cargando préstamos...
      </div>

      <!-- Error -->
      <div class="empty-state error" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>
      <!-- Sin resultados -->
      <div class="empty-state" *ngIf="!isLoading && !errorMessage && filasFiltradas.length === 0">
        No tienes préstamos ni solicitudes pendientes
      </div>

      <!-- Filas de préstamos -->
      <div class="table-row" *ngFor="let fila of filasFiltradas">

        <!-- Columna: Material -->
        <div class="td td-material">
          {{ fila.material }}
        </div>

        <!-- Columna: Tipo -->
        <div class="td td-tipo">
          {{ fila.tipoSolicitud }}
        </div>

        <!-- Columna: Fecha Préstamo -->
        <div class="td td-fecha-prestamo">
          {{ formatearFecha(fila.fecha) }}
        </div>

        <!-- Columna: Fecha Devolución -->
        <div class="td td-fecha-devolucion">
          {{ fila.fechaFin ? formatearFecha(fila.fechaFin) : '—' }}
        </div>

        <!-- Columna: Estado -->
        <div class="td td-estado">
          <span class="badge" [ngClass]="getEstadoClass(fila.estado)">
            {{ getEstadoTexto(fila.estado) }}
          </span>
        </div>

      </div>

    </div>

  </div>

</div>