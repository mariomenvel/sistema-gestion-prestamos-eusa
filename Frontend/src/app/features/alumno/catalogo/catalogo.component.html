<div class="catalogo">

  <!-- T√çTULO -->
  <h1 class="catalogo-title">Cat√°logo</h1>

  <!-- BARRA DE B√öSQUEDA Y FILTROS R√ÅPIDOS -->
  <div class="search-filters-row">

    <!-- Barra de b√∫squeda -->
    <div class="search-bar">
      <input type="text" class="search-input" placeholder="Buscar Libros, c√°maras, micr√≥fonos..."
        [(ngModel)]="textoBusqueda" (keyup.enter)="buscar()">
      <button class="search-icon" (click)="buscar()">üîç</button>
    </div>

    <!-- Filtros r√°pidos -->
    <div class="quick-filters">
      <button class="filter-btn" [class.active]="filtroTipoActivo === 'todos'" (click)="cambiarFiltroTipo('todos')">
        Todos
      </button>

      <button class="filter-btn" [class.active]="filtroTipoActivo === 'libros'" (click)="cambiarFiltroTipo('libros')">
        Libros
      </button>

      <button class="filter-btn" [class.active]="filtroTipoActivo === 'equipos'" (click)="cambiarFiltroTipo('equipos')">
        Material Audiovisual
      </button>
    </div>

  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="catalogo-content">

    <!-- PANEL LATERAL DE FILTROS -->
    <aside class="filters-panel">
      <h2 class="filters-title">Filtros</h2>

      <!-- Tipo de Material -->
      <div class="filter-section">
        <h3 class="filter-section-title">Tipo de Material</h3>
        <div class="filter-divider"></div>

        <label class="checkbox-label">
          <input type="checkbox" [checked]="filtroTipoActivo === 'libros'" (change)="cambiarFiltroTipo('libros')">
          <span>Libros</span>
        </label>

        <label class="checkbox-label">
          <input type="checkbox" [checked]="filtroTipoActivo === 'equipos'" (change)="cambiarFiltroTipo('equipos')">
          <span>Material Audiovisual</span>
        </label>
      </div>

      <!-- Filtro por Categor√≠a de Equipo (Solo para Audiovisual) -->
      <div class="filter-section" *ngIf="filtroTipoActivo === 'equipos'">
        <h3 class="filter-section-title">Categor√≠a</h3>
        <div class="filter-divider"></div>

        <div class="checkbox-group">
          <label class="checkbox-label" *ngFor="let cat of categoriasEquipos">
            <input type="checkbox" [checked]="isCategoriaEquipoSeleccionada(cat.id)"
              (change)="toggleCategoriaEquipo(cat.id)">
            <span>{{ cat.nombre }}</span>
          </label>
        </div>
      </div>

      <!-- Filtro por Nombre de Equipo (Solo para Audiovisual) -->
      <div class="filter-section" *ngIf="filtroTipoActivo === 'equipos'">
        <h3 class="filter-section-title">Nombre de Equipo</h3>
        <div class="filter-divider"></div>

        <div class="checkbox-group">
          <label class="checkbox-label" *ngFor="let nombre of nombresEquipo">
            <input type="checkbox" [checked]="isNombreSeleccionado(nombre.id)" (change)="toggleNombreEquipo(nombre.id)">
            <span>{{ nombre.nombre }}</span>
          </label>
        </div>
      </div>

      <!-- Filtro por G√©nero (Solo para Libros) -->
      <div class="filter-section" *ngIf="filtroTipoActivo === 'libros'">
        <h3 class="filter-section-title">G√©nero</h3>
        <div class="filter-divider"></div>

        <div class="checkbox-group">
          <label class="checkbox-label" *ngFor="let genero of generos">
            <input type="checkbox" [checked]="isGeneroSeleccionado(genero.id)" (change)="toggleGenero(genero.id)">
            <span>{{ genero.nombre }}</span>
          </label>
        </div>
      </div>
    </aside>

    <!-- GRID DE MATERIALES -->
    <main class="materials-grid">

      <!-- Loading -->
      <div *ngIf="isLoading" class="loading-state">
        Cargando materiales...
      </div>

      <!-- Error -->
      <div *ngIf="errorMessage" class="error-state">
        {{ errorMessage }}
      </div>

      <!-- Sin resultados -->
      <div *ngIf="!isLoading && !errorMessage && materialesFiltrados.length === 0" class="empty-state">
        No se encontraron materiales con los filtros seleccionados.
      </div>

      <!-- Cards de materiales -->
      <article class="material-card" *ngFor="let material of materialesFiltrados">

        <!-- Imagen -->
        <div class="material-image">
          <img *ngIf="material.imagenUrl" [src]="material.imagenUrl" [alt]="material.titulo">
          <div *ngIf="!material.imagenUrl" class="image-placeholder">
            {{ material.tipo === 'libro' ? 'üìö' : 'üì∑' }}
          </div>
        </div>

        <!-- Informaci√≥n -->
        <div class="material-info">
          <h3 class="material-title">{{ material.titulo }}</h3>
          <p class="material-category">{{ material.categoria }}</p>
          <p class="material-brand">{{ material.marcaModelo }}</p>
          <p class="material-description">{{ material.descripcion }}</p>
        </div>

        <!-- Bot√≥n Solicitar -->
        <button class="btn-solicitar" (click)="solicitarPrestamo(material)">
          Solicitar
        </button>

      </article>

    </main>

  </div>

</div>

<!-- Modal Solicitar Pr√©stamo -->
<app-solicitar-prestamo [isOpen]="mostrarModalSolicitud" [material]="materialSeleccionado"
  [todosLosMateriales]="materiales" (close)="cerrarModalSolicitud()"
  (solicitudCreada)="onSolicitudCreada()"></app-solicitar-prestamo>